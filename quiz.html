<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz - MiniLMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">

  <nav class="bg-white shadow">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="font-bold text-xl">MiniLMS</a>
      <div class="space-x-4">
        <a href="courses.html" class="hover:underline">Courses</a>
        <a href="dashboard.html" class="hover:underline">Dashboard</a>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-4 py-8" id="quiz-main"></main>

  <script>
    const params = new URLSearchParams(location.search);
    const courseId = Number(params.get('course'));
    const container = document.getElementById('quiz-main');

    fetch('courses.json')
      .then(res => res.json())
      .then(courses => {
        const course = courses.find(c => c.id === courseId);
        if (!course) {
          container.innerHTML = 'Course not found';
          return;
        }

        // Example quiz questions with explanations
        const courseQuestions = course.quiz || [
          {
            q: "What does HTML stand for?",
            options: ["Hyper Text Markup Language", "High Text Markup Language", "Hyperlink Text Mark Language", "Hyper Tool Markup Language"],
            answer: 0,
            desc: "HTML stands for Hyper Text Markup Language, which is used to structure content on the web."
          },
          {
            q: "Which tag is used for a paragraph in HTML?",
            options: ["<p>", "<div>", "<span>", "<h1>"],
            answer: 0,
            desc: "The <p> tag defines a paragraph in HTML."
          },
          {
            q: "Which property is used to change text color in CSS?",
            options: ["font-color", "color", "text-color", "background-color"],
            answer: 1,
            desc: "The CSS property 'color' is used to change the text color."
          },
          {
            q: "Inside which HTML element do we put JavaScript?",
            options: ["<js>", "<script>", "<javascript>", "<code>"],
            answer: 1,
            desc: "The <script> tag is used to embed JavaScript in HTML."
          },
          {
            q: "Which symbol is used for comments in JavaScript?",
            options: ["//", "/* */", "#", "<!-- -->"],
            answer: 0,
            desc: "In JavaScript, single-line comments use // and multi-line comments use /* */."
          }
        ];

        function showQuiz() {
          container.innerHTML = `
            <div class="bg-white rounded shadow p-6">
              <h1 class="text-2xl font-bold mb-4">Quiz - ${course.title}</h1>
              <form id="quiz-form"></form>
            </div>
          `;
          const form = document.getElementById('quiz-form');

          courseQuestions.forEach((q, idx) => {
            const div = document.createElement('div');
            div.className = 'mb-4';
            div.innerHTML = `<div class="font-semibold">${idx + 1}. ${q.q}</div>`;
            q.options.forEach((opt, i) => {
              div.innerHTML += `
                <label class="block">
                  <input type="radio" name="q${idx}" value="${i}" class="mr-2">
                  ${opt}
                </label>
              `;
            });
            form.appendChild(div);
          });

          const submit = document.createElement('button');
          submit.type = 'submit';
          submit.className = 'bg-indigo-600 text-white px-4 py-2 rounded';
          submit.textContent = 'Submit';
          form.appendChild(submit);

          form.addEventListener('submit', e => {
            e.preventDefault();
            const data = new FormData(form);
            let score = 0;

            container.innerHTML = `
              <div class="bg-white rounded shadow p-6">
                <h1 class="text-2xl font-bold mb-4">Results - ${course.title}</h1>
              </div>
            `;
            const resultDiv = container.querySelector('div');

            courseQuestions.forEach((q, idx) => {
              const selected = data.get('q' + idx);
              const isCorrect = Number(selected) === q.answer;
              if (isCorrect) score++;

              const qResult = document.createElement('div');
              qResult.className = 'mb-4 p-4 rounded border';
              qResult.innerHTML = `
                <div class="font-semibold">${idx + 1}. ${q.q}</div>
                <p>Your Answer: ${selected !== null ? q.options[selected] : 'Not answered'} ${isCorrect ? '✅' : '❌'}</p>
                <p>Correct Answer: ${q.options[q.answer]}</p>
                <p class="text-gray-700 italic">Explanation: ${q.desc}</p>
              `;
              resultDiv.appendChild(qResult);
            });

            const percent = Math.round((score / courseQuestions.length) * 100);
            localStorage.setItem('mlms_quiz_' + courseId, JSON.stringify({ score: percent }));

            const scoreDiv = document.createElement('div');
            scoreDiv.className = 'mt-4 p-4 bg-gray-100 rounded';
            scoreDiv.innerHTML = `Total Score: ${score}/${courseQuestions.length} (${percent}%) — ${percent >= 50 ? '<strong>Passed</strong>' : '<strong>Failed</strong>'}`;
            resultDiv.appendChild(scoreDiv);

            if (percent < 50) {
              const retryBtn = document.createElement('button');
              retryBtn.className = 'mt-3 px-4 py-2 bg-yellow-500 text-white rounded';
              retryBtn.textContent = 'Retry Quiz';
              retryBtn.onclick = showQuiz;
              resultDiv.appendChild(retryBtn);
            }
          });
        }

        const savedQuiz = JSON.parse(localStorage.getItem('mlms_quiz_' + courseId));
        if (!savedQuiz || savedQuiz.score < 50) {
          showQuiz();
        } else {
          // If passed, show result
          showQuiz(); // You can customize to show a read-only result if needed
        }

      });
  </script>
</body>
</html>
